# Инструкция по настройке отправки писем

В данной папке содержатся файлы для отправки электронных писем из интернет-магазина.

## Описание файлов

- `Mailer.php` - основной класс для отправки писем
- `mail_config.php` - файл конфигурации с настройками SMTP-сервера
- `README.md` - инструкция по настройке

## Настройка отправки писем

Для корректной работы отправки писем необходимо настроить параметры в файле `mail_config.php`:

### 1. Выбор почтового сервиса

В начале файла `mail_config.php` выберите нужный почтовый сервис, изменив переменную `$mail_service`:

```php
// Выберите почтовый сервис, указав его название: 'yandex', 'gmail' или 'mail'
$mail_service = 'yandex';
```

Доступные варианты:
- `yandex` - для Яндекс.Почты
- `gmail` - для Gmail
- `mail` - для Mail.ru

### 2. Настройка параметров выбранного сервиса

Найдите секцию с настройками для выбранного сервиса и укажите ваши учетные данные:

```php
// Настройки для Gmail
'gmail' => [
    'host' => 'smtp.gmail.com',
    'port' => 587,
    'encryption' => 'tls',
    'username' => 'your-email@gmail.com', // Измените на ваш Gmail
    'password' => 'your-app-password',    // Измените на ваш пароль для приложений
    'from_email' => 'your-email@gmail.com',
    'from_name' => 'X64Shop'              // Имя отправителя
],
```

### 3. Настройка контактной информации магазина

```php
// Контактная информация магазина для отображения в письмах
define('SHOP_PHONE', '+7 (962) 276-39-27');
define('SHOP_SUPPORT_EMAIL', 'support@x64shop.ru');
define('SHOP_WEBSITE', 'https://x64shop.ru');
```

## Получение паролей для почтовых сервисов

### Яндекс.Почта

1. Войдите в свой аккаунт Яндекс
2. Перейдите в раздел "Безопасность и вход"
3. Включите "Доступ к аккаунту для приложений" (если не включен)
4. Нажмите "Пароли приложений" и создайте новый пароль
5. Скопируйте созданный пароль и вставьте его в настройки в поле `password`

### Gmail

1. Войдите в свой аккаунт Google
2. Перейдите в раздел "Безопасность"
3. Включите двухфакторную аутентификацию, если она не включена
4. Найдите раздел "Пароли приложений"
5. Выберите "Почта" и "Другое устройство", введите название (например, "X64Shop")
6. Нажмите "Создать" и скопируйте созданный пароль
7. Вставьте этот пароль в настройки в поле `password`

### Mail.ru

1. Войдите в свой аккаунт Mail.ru
2. Перейдите в раздел "Настройки" > "Безопасность"
3. Найдите раздел "Пароли для внешних приложений"
4. Создайте новый пароль для приложения
5. Скопируйте созданный пароль и вставьте его в настройки в поле `password`

## Тестирование отправки

Для проверки настроек вы можете использовать метод `sendTestEmail()` класса `Mailer`:

```php
// Пример использования
$mailer = new Mailer();
$result = $mailer->sendTestEmail('your-email@example.com');

if ($result['success']) {
    echo "Тестовое письмо успешно отправлено!";
} else {
    echo "Ошибка при отправке письма: " . $result['message'];
}
```

## Решение проблем

Если письма не отправляются:

1. **Проверьте учетные данные**: Убедитесь, что email и пароль указаны верно
2. **Пароль для приложений**: Используйте специальный пароль для приложений, а не основной пароль аккаунта
3. **Настройки безопасности почты**:
   - Gmail: Убедитесь, что включен "Доступ к аккаунту для приложений с недостаточным уровнем безопасности"
   - Яндекс: Проверьте, разрешено ли использование внешних приложений
   - Mail.ru: Убедитесь, что создан пароль для внешних приложений
4. **Проверьте порт**: Некоторые хостинги могут блокировать определенные порты. Попробуйте изменить порт:
   - Для TLS: попробуйте порт 587 или 25
   - Для SSL: попробуйте порт 465 или 993
5. **Проверьте ошибки**: Используйте функцию `error_log()` для записи ошибок в лог

## Использование в коде

Система автоматически отправляет письма при оформлении заказа в `checkout.php`:

```php
// Отправляем электронное письмо покупателю и администратору
$mailer = new Mailer();
$customer_notification = $mailer->sendOrderConfirmation($order, $order_items);
$admin_notification = $mailer->sendOrderNotificationToAdmin($order, $order_items);
``` 