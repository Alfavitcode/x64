# Руководство по FTP-деплою из GitHub

Данное руководство описывает настройку и использование автоматического деплоя на FTP через GitHub Actions.

## Содержание

1. [Обзор](#обзор)
2. [Настройка GitHub Secrets](#настройка-github-secrets)
3. [Как работает деплой](#как-работает-деплой)
4. [Запуск деплоя вручную](#запуск-деплоя-вручную)
5. [Тестирование FTP-соединения](#тестирование-ftp-соединения)
6. [Отчет о деплое](#отчет-о-деплое)
7. [Исключенные файлы](#исключенные-файлы)
8. [Устранение неполадок](#устранение-неполадок)

## Обзор

Автоматический деплой настроен так, что при каждом пуше в ветку `main` или при ручном запуске из раздела Actions, все изменения будут автоматически загружены на FTP-сервер.

## Настройка GitHub Secrets

Для работы деплоя необходимо добавить секреты в репозиторий:

1. Откройте репозиторий на GitHub
2. Перейдите в `Settings` -> `Secrets and variables` -> `Actions`
3. Нажмите `New repository secret`
4. Добавьте следующие секреты:

| Название секрета | Описание | Пример |
|-----------------|----------|--------|
| `FTP_SERVER` | Адрес FTP-сервера | `ftp.example.com` |
| `FTP_USERNAME` | Имя пользователя FTP | `user` |
| `FTP_PASSWORD` | Пароль FTP | `password` |
| `FTP_SERVER_DIR` | Директория на сервере | `/public_html/` или `/` |

## Как работает деплой

Процесс деплоя выполняет следующие шаги:

1. Клонирует репозиторий
2. Устанавливает PHP 7.4
3. Устанавливает зависимости из composer.json (если файл существует)
4. Генерирует отчет о деплое
5. Загружает файлы на FTP-сервер
6. Сохраняет отчет о деплое как артефакт GitHub Actions

## Запуск деплоя вручную

Для запуска деплоя вручную:

1. Откройте репозиторий на GitHub
2. Перейдите в раздел `Actions`
3. Выберите workflow `FTP Deploy` слева
4. Нажмите `Run workflow`
5. Выберите ветку для деплоя (обычно `main`)
6. Нажмите `Run workflow`

## Тестирование FTP-соединения

Перед настройкой автоматического деплоя рекомендуется проверить FTP-соединение с помощью скрипта:

1. Откройте файл `tools/test-ftp-connection.php`
2. Введите ваши FTP-реквизиты
3. Запустите скрипт:
   ```bash
   php tools/test-ftp-connection.php
   ```
4. Убедитесь, что соединение успешно установлено

> **Важно:** Не коммитьте файл с реальными данными в репозиторий!

## Отчет о деплое

После каждого деплоя генерируется отчет, содержащий:

- Дату и время деплоя
- Ветку и хеш коммита
- Общее количество файлов в репозитории
- Список измененных файлов
- Сводку по типам файлов

Этот отчет доступен как артефакт в разделе Actions на GitHub.

## Исключенные файлы

Следующие файлы и директории не загружаются на сервер:

- `.git` и `.github` (служебные файлы Git и GitHub)
- `node_modules` (модули Node.js)
- `vendor` (зависимости Composer)
- `composer.json` и `composer.lock` (файлы зависимостей)
- `README.md` (документация)
- `.gitignore` (настройки Git)
- `deployment-report.md` (отчет о деплое)

## Устранение неполадок

### Проблема: Деплой не запускается

1. Убедитесь, что workflow включен в разделе Actions
2. Проверьте, что вы выполняете пуш в ветку `main`

### Проблема: Ошибка FTP-соединения

1. Проверьте правильность секретов в GitHub
2. Убедитесь, что FTP-сервер доступен
3. Проверьте, что директория на сервере существует и у пользователя есть права на запись

### Проблема: Некоторые файлы не загружаются

1. Проверьте, не находятся ли файлы в списке исключений
2. Убедитесь, что файлы закоммичены в ветку `main` 